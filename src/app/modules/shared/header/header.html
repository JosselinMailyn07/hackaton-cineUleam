<header class="headerContainer">
  <div class="headerContent">
    <!-- Sección Izquierda - Logo y Navegación -->
    <div class="headerLeft">
      <!-- Botón menú hamburguesa - SIEMPRE visible en móvil -->
      @if (esMovil) {
      <button 
        pButton 
        icon="pi pi-bars" 
        class="p-button-text p-button-plain botonMenu"
        (click)="alternarMenuMovil()"
        pTooltip="Menú principal"
        tooltipPosition="bottom">
      </button>
      }
      
      <div class="logoContainer" routerLink="/inicio">
        <div class="logoWrapper">
          <div class="logoIcono">
            <i class="pi pi-play-circle"></i>
          </div>
          <div class="logoTexto">
            <span class="logoTitulo">Cine ULEAM</span>
            @if (!esMovilPequena) {
            <span class="logoVersion">4.0</span>
            }
          </div>
        </div>
        @if (!esMovilPequena) {
        <div class="logoBadge">Beta</div>
        }
      </div>

      <!-- Navegación principal SOLO en desktop -->
      @if (!esMovil) {
      <nav class="navegacionPrincipal">
        <a 
          *ngFor="let item of itemsNavegacion"
          class="navItem"
          [routerLink]="item.ruta"
          routerLinkActive="navItemActivo">
          <i [class]="item.icono"></i>
          <span class="navTexto">{{ item.texto }}</span>
          <span class="navIndicador"></span>
        </a>
      </nav>
      }
    </div>

    <!-- Sección Central - Búsqueda -->
    <div class="headerCenter">
      <!-- Búsqueda desktop/tablet -->
      @if (mostrarBuscador && !esMovilPequena) {
      <div class="buscadorContainer">
        <div class="buscadorWrapper" [class.buscadorExpandido]="buscadorExpandido">
          
          <!-- Estado Compacto - Solo Icono -->
          @if (!buscadorExpandido) {
          <div class="buscadorCompacto">
            <button 
              pButton 
              icon="pi pi-search" 
              class="p-button-text p-button-plain botonBuscarCompacto"
              (click)="expandirBuscador()"
              pTooltip="Buscar películas"
              tooltipPosition="bottom">
            </button>
          </div>
          }
      
          <!-- Estado Expandido - Input Completo -->
          @if (buscadorExpandido) {
          <div class="buscadorExpandidoContent">
            <div class="buscadorInputGroup">
              <span class="p-input-icon-left iconoBusqueda">
                <i class="pi pi-search"></i>
                <input 
                  type="text" 
                  pInputText 
                  placeholder="Buscar películas..." 
                  [(ngModel)]="terminoBusqueda"
                  (keyup.enter)="realizarBusqueda()"
                  (input)="onBuscarInput()"
                  (blur)="onBuscarBlur()"
                  class="buscadorInput"
                  #buscadorInput
                  autocomplete="off" />
              </span>
              
              <!-- Botón Cerrar Búsqueda -->
              <button 
                pButton 
                icon="pi pi-times" 
                class="p-button-text p-button-plain botonCerrarBusqueda"
                (click)="contraerBuscador()"
                pTooltip="Cerrar búsqueda"
                tooltipPosition="bottom">
              </button>
            </div>
      
            <!-- Sugerencias -->
            @if (mostrarSugerencias && terminoBusqueda && sugerencias.length > 0) {
            <div class="sugerenciasWrapper">
              <div class="sugerenciasContainer">
                <div class="sugerenciaHeader">
                  <span class="sugerenciaTitulo">Sugerencias</span>
                  <span class="sugerenciaContador">{{ sugerencias.length }} resultados</span>
                </div>
                
                <div class="sugerenciasLista">
                  <div 
                    class="sugerenciaItem" 
                    *ngFor="let sugerencia of sugerencias; trackBy: trackBySugerencia"
                    (click)="seleccionarSugerencia(sugerencia)"
                    (mousedown)="prevenirBlur($event)">
                    <div class="sugerenciaIcono">
                      <i class="pi pi-search"></i>
                    </div>
                    <div class="sugerenciaTexto">
                      <span class="sugerenciaTermino">{{ sugerencia }}</span>
                      <span class="sugerenciaTipo">Película</span>
                    </div>
                    <div class="sugerenciaAccion">
                      <i class="pi pi-arrow-right"></i>
                    </div>
                  </div>
                </div>
                
                <div class="sugerenciaFooter">
                  <span class="sugerenciaAyuda">Presiona Enter para buscar</span>
                </div>
              </div>
            </div>
            }
          </div>
          }
        </div>
      
        <!-- Overlay para cerrar búsqueda al hacer clic fuera -->
        @if (buscadorExpandido && mostrarSugerencias) {
        <div 
          class="buscadorOverlay" 
          (click)="contraerBuscador()">
        </div>
        }
      </div>
      }

      <!-- Búsqueda Móvil Compacta -->
      @if (esMovilPequena && mostrarBuscador) {
      <div class="buscadorMovilCompacto">
        <button 
          pButton 
          icon="pi pi-search" 
          class="p-button-text p-button-plain botonBuscarMovil"
          (click)="activarBusquedaMovil()"
          pTooltip="Buscar"
          tooltipPosition="bottom">
        </button>
      </div>
      }
    </div>

    <!-- Sección Derecha - Usuario y Acciones -->
    <div class="headerRight">
      <!-- Notificaciones -->
      @if (usuarioLogueado) {
      <div class="accionesRapidas" [class.accionesRapidasMovil]="esMovilPequena">
        <button 
          pButton 
          icon="pi pi-bell" 
          class="p-button-text p-button-plain botonAccion"
          [class.botonAccionMovil]="esMovilPequena"
          (click)="alternarNotificaciones()"
          pTooltip="Notificaciones"
          tooltipPosition="bottom">
          @if (notificacionesNoLeidas > 0) {
          <span class="badgeNotificacion" [class.badgeNotificacionMovil]="esMovilPequena">
            {{ notificacionesNoLeidas }}
          </span>
          }
        </button>
      </div>
      }

      <!-- Usuario -->
      @if (usuarioLogueado) {
      <div class="usuarioCompacto">
        <p-menu 
          #menu 
          [model]="itemsMenu" 
          [popup]="true" 
          styleClass="menuUsuarioSuperior"
          [appendTo]="'body'">
        </p-menu>
        
        <button 
          pButton 
          class="p-button-text p-button-plain botonUsuario"
          (click)="menu.toggle($event)"
          [class.menuAbierto]="menuAbierto"
          [class.botonUsuarioMovil]="esMovilPequena">
          <div class="avatarMini" [class.avatarMiniMovil]="esMovilPequena">
            {{ obtenerIniciales(usuarioLogueado.nombre) }}
          </div>
          @if (!esMovilPequena) {
          <span class="usuarioNombreMini">
            {{ usuarioLogueado.nombre.split(' ')[0] }}
          </span>
          }
          @if (!esMovilPequena) {
          <i class="pi pi-chevron-down iconoDropdown"></i>
          }
        </button>
      </div>
      }

      <!-- Estado de Login -->
      @if (!usuarioLogueado) {
      <div class="accionesLogin">
        @if (!esMovilPequena) {
        <button 
          pButton 
          label="Iniciar Sesión" 
          class="p-button-outlined botonLogin"
          routerLink="/login">
        </button>
        }
        <button 
          pButton 
          [label]="esMovilPequena ? 'Entrar' : 'Registrarse'" 
          class="p-button-primary botonRegistro"
          [class.botonRegistroMovil]="esMovilPequena"
          routerLink="/registro">
        </button>
      </div>
      }
    </div>
  </div>
 
  <!-- Panel de Navegación Móvil -->
  @if (mostrarMenuMovil) {
  <div class="panelNavegacionMovil" [class.panelNavegacionAbierto]="mostrarMenuMovil">
    <div class="panelNavegacionHeader">
      <h3>Menú Principal</h3>
      <button 
        pButton 
        icon="pi pi-times" 
        class="p-button-text p-button-plain"
        (click)="cerrarMenuMovil()">
      </button>
    </div>
    <nav class="navegacionMovil">
      <a 
        *ngFor="let item of itemsNavegacion"
        class="navItemMovil"
        [routerLink]="item.ruta"
        routerLinkActive="navItemMovilActivo"
        (click)="cerrarMenuMovil()">
        <i [class]="item.icono"></i>
        <span class="navTextoMovil">{{ item.texto }}</span>
        <i class="pi pi-chevron-right"></i>
      </a>
      
      <!-- Items adicionales para móvil -->
      <div class="separadorMovil"></div>
      
      <a class="navItemMovil" routerLink="/configuracion" (click)="cerrarMenuMovil()">
        <i class="pi pi-cog"></i>
        <span class="navTextoMovil">Configuración</span>
        <i class="pi pi-chevron-right"></i>
      </a>
      
      @if (usuarioLogueado) {
      <a class="navItemMovil" routerLink="/perfil" (click)="cerrarMenuMovil()">
        <i class="pi pi-user"></i>
        <span class="navTextoMovil">Mi Perfil</span>
        <i class="pi pi-chevron-right"></i>
      </a>
      }
    </nav>
    
    <div class="panelNavegacionFooter">
      @if (usuarioLogueado) {
      <button 
        pButton 
        label="Cerrar Sesión" 
        icon="pi pi-sign-out"
        class="p-button-text p-button-danger botonCerrarSesionMovil"
        (click)="cerrarSesion(); cerrarMenuMovil()">
      </button>
      } @else {
      <div class="accionesLoginMovil">
        <button 
          pButton 
          label="Iniciar Sesión" 
          class="p-button-outlined botonLoginMovil"
          (click)="cerrarMenuMovil()"
          routerLink="/login">
        </button>
        <button 
          pButton 
          label="Registrarse" 
          class="p-button-primary botonRegistroMovil"
          (click)="cerrarMenuMovil()"
          routerLink="/registro">
        </button>
      </div>
      }
    </div>
  </div>
  
  <!-- Overlay para cerrar menú móvil -->
  <div class="overlayMenuMovil overlayVisible" (click)="cerrarMenuMovil()"></div>
  }

  <!-- Panel de Notificaciones Responsive -->
  @if (mostrarPanelNotificaciones) {
  <div class="panelNotificaciones" [class.panelNotificacionesMovil]="esMovil">
    <div class="panelHeader">
      <h3>Notificaciones</h3>
      <button 
        pButton 
        icon="pi pi-times" 
        class="p-button-text p-button-plain"
        (click)="cerrarNotificaciones()">
      </button>
    </div>
    <div class="listaNotificaciones">
      <div class="notificacionItem" *ngFor="let notificacion of notificaciones">
        <div class="notificacionIcono">
          <i [class]="notificacion.icono"></i>
        </div>
        <div class="notificacionContenido">
          <p class="notificacionTitulo">{{ notificacion.titulo }}</p>
          <p class="notificacionTiempo">{{ notificacion.tiempo }}</p>
        </div>
      </div>
    </div>
  </div>
  }

  <!-- Modal de Búsqueda Móvil -->
  @if (mostrarModalBusqueda) {
  <div class="modalBusquedaMovil">
    <div class="modalHeader">
      <h3>Buscar Películas</h3>
      <button 
        pButton 
        icon="pi pi-times" 
        class="p-button-text p-button-plain"
        (click)="cerrarModalBusqueda()">
      </button>
    </div>
    <div class="modalContent">
      <div class="buscadorInputGroupMovil">
        <span class="p-input-icon-left">
          <i class="pi pi-search"></i>
          <input 
            type="text" 
            pInputText 
            placeholder="Buscar películas..." 
            [(ngModel)]="terminoBusquedaMovil"
            (keyup.enter)="realizarBusquedaMovil()"
            class="buscadorInputMovil"
            autocomplete="off" />
        </span>
      </div>
      
      @if (terminoBusquedaMovil && sugerenciasMovil.length > 0) {
      <div class="sugerenciasMovil">
        <div class="sugerenciasListaMovil">
          <div 
            class="sugerenciaItemMovil" 
            *ngFor="let sugerencia of sugerenciasMovil"
            (click)="seleccionarSugerenciaMovil(sugerencia)">
            <i class="pi pi-search"></i>
            <span>{{ sugerencia }}</span>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
  }
</header>